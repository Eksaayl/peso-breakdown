<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Philippine Peso Cash Fund Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['DM Sans', 'system-ui', 'sans-serif'] },
          colors: {
            peso: { gold: '#B8860B', pink: '#fc9483', cream: '#faf8f5', dark: '#d65f4e' }
          }
        }
      }
    }
  </script>
  <style>
    html { -webkit-tap-highlight-color: transparent; }
    body { padding-bottom: max(1.5rem, env(safe-area-inset-bottom, 0)); }
    input[type="number"] { -moz-appearance: textfield; }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  </style>
</head>
<body class="font-sans bg-gradient-to-br from-peso-cream to-amber-50 min-h-screen text-gray-800">
  <div class="max-w-xl mx-auto px-4 py-8">
    <header class="text-center mb-8">
      <h1 class="text-3xl font-bold text-peso-dark tracking-tight mb-2">Cash Breakdown</h1>
      <p class="text-gray-500 text-sm">Separate your ₱5,000 fund from your sales.</p>
    </header>

    <section class="bg-white/80 backdrop-blur-xl rounded-2xl shadow-xl shadow-amber-900/5 border border-amber-100 p-6 mb-6">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-sm font-bold text-gray-400 uppercase tracking-widest">Stock Inventory</h2>
        <button type="button" id="clear-btn" class="text-xs font-semibold text-peso-dark hover:text-peso-gold transition">
          Clear All
        </button>
      </div>
      
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
        <div class="col-span-2 sm:col-span-3 bg-amber-50 rounded-xl p-4 border border-amber-100 flex items-center justify-between mb-2">
            <div>
                <span class="block text-lg font-bold text-gray-700">₱1,000</span>
                <span class="text-xs text-amber-600 font-medium">Always goes to Sales/Excess</span>
            </div>
            <input type="number" id="amt-1000" min="0" placeholder="0"
            class="w-24 text-right bg-white px-3 py-2 rounded-lg border border-amber-200 focus:border-peso-pink focus:ring-2 focus:ring-peso-pink/20 outline-none text-xl font-medium">
        </div>

        <label class="group cursor-pointer">
          <span class="block text-xs font-semibold text-gray-500 mb-1 group-hover:text-peso-dark transition">₱500</span>
          <input type="number" id="amt-500" min="0" placeholder="0"
            class="w-full bg-white px-4 py-3 rounded-xl border-2 border-gray-100 focus:border-peso-pink focus:ring-4 focus:ring-peso-pink/10 outline-none transition text-lg font-medium text-center shadow-sm">
        </label>
        
        <label class="group cursor-pointer">
          <span class="block text-xs font-semibold text-gray-500 mb-1 group-hover:text-peso-dark transition">₱200</span>
          <input type="number" id="amt-200" min="0" placeholder="0"
            class="w-full bg-white px-4 py-3 rounded-xl border-2 border-gray-100 focus:border-peso-pink focus:ring-4 focus:ring-peso-pink/10 outline-none transition text-lg font-medium text-center shadow-sm">
        </label>
        
        <label class="group cursor-pointer">
          <span class="block text-xs font-semibold text-gray-500 mb-1 group-hover:text-peso-dark transition">₱100</span>
          <input type="number" id="amt-100" min="0" placeholder="0"
            class="w-full bg-white px-4 py-3 rounded-xl border-2 border-gray-100 focus:border-peso-pink focus:ring-4 focus:ring-peso-pink/10 outline-none transition text-lg font-medium text-center shadow-sm">
        </label>

        <label class="group cursor-pointer">
          <span class="block text-xs font-semibold text-gray-500 mb-1 group-hover:text-peso-dark transition">₱50</span>
          <input type="number" id="amt-50" min="0" placeholder="0"
            class="w-full bg-white px-4 py-3 rounded-xl border-2 border-gray-100 focus:border-peso-pink focus:ring-4 focus:ring-peso-pink/10 outline-none transition text-lg font-medium text-center shadow-sm">
        </label>

        <label class="group cursor-pointer">
          <span class="block text-xs font-semibold text-gray-500 mb-1 group-hover:text-peso-dark transition">₱20</span>
          <input type="number" id="amt-20" min="0" placeholder="0"
            class="w-full bg-white px-4 py-3 rounded-xl border-2 border-gray-100 focus:border-peso-pink focus:ring-4 focus:ring-peso-pink/10 outline-none transition text-lg font-medium text-center shadow-sm">
        </label>

        <label class="group cursor-pointer">
          <span class="block text-xs font-semibold text-gray-500 mb-1 group-hover:text-peso-dark transition">₱10</span>
          <input type="number" id="amt-10" min="0" placeholder="0"
            class="w-full bg-white px-4 py-3 rounded-xl border-2 border-gray-100 focus:border-peso-pink focus:ring-4 focus:ring-peso-pink/10 outline-none transition text-lg font-medium text-center shadow-sm">
        </label>

        <label class="group cursor-pointer">
          <span class="block text-xs font-semibold text-gray-500 mb-1 group-hover:text-peso-dark transition">₱5</span>
          <input type="number" id="amt-5" min="0" placeholder="0"
            class="w-full bg-white px-4 py-3 rounded-xl border-2 border-gray-100 focus:border-peso-pink focus:ring-4 focus:ring-peso-pink/10 outline-none transition text-lg font-medium text-center shadow-sm">
        </label>
        
        <label class="group cursor-pointer">
            <span class="block text-xs font-semibold text-gray-500 mb-1 group-hover:text-peso-dark transition">₱1</span>
            <input type="number" id="amt-1" min="0" placeholder="0"
              class="w-full bg-white px-4 py-3 rounded-xl border-2 border-gray-100 focus:border-peso-pink focus:ring-4 focus:ring-peso-pink/10 outline-none transition text-lg font-medium text-center shadow-sm">
          </label>
      </div>
      
      <div class="mt-6 pt-4 border-t border-gray-100 flex justify-between items-center text-sm text-gray-500">
        <span>Current Stock Value:</span>
        <span id="current-total" class="font-bold text-gray-800 text-lg">₱0</span>
      </div>
    </section>

    <button type="button" id="calculate" class="w-full py-4 rounded-xl bg-gradient-to-r from-peso-pink to-peso-dark hover:from-peso-dark hover:to-peso-pink active:scale-[0.99] text-white font-bold text-lg shadow-lg shadow-pink-500/30 transition-all duration-200 touch-manipulation mb-8">
      Calculate Breakdown
    </button>

    <div id="error-box" class="hidden mb-6 p-4 rounded-xl bg-red-50 border border-red-100 text-red-700 flex items-start gap-3 animate-in fade-in slide-in-from-top-4">
      <svg class="w-5 h-5 mt-0.5 flex-shrink-0 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
      <div>
          <h3 class="font-bold text-sm mb-1">Calculation Failed</h3>
          <p id="error-text" class="text-sm opacity-90"></p>
      </div>
    </div>

    <div id="result-container" class="hidden space-y-6 animate-in fade-in slide-in-from-bottom-8 duration-500">
      
      <section class="bg-white rounded-2xl shadow-xl shadow-amber-900/5 border border-amber-100 overflow-hidden">
        <div class="bg-peso-dark text-white px-6 py-4 flex justify-between items-center">
          <div>
              <h2 class="font-bold text-lg">Cash Fund</h2>
              <p class="text-white/80 text-xs">Smaller bills for change</p>
          </div>
          <span class="bg-white/20 px-3 py-1 rounded-full text-sm font-mono font-bold">₱5,000</span>
        </div>
        <div class="p-6">
            <ul id="breakdown-list" class="space-y-3"></ul>
        </div>
      </section>

      <section class="bg-white rounded-2xl shadow-xl shadow-amber-900/5 border border-amber-100 overflow-hidden relative">
        <div class="absolute top-0 left-0 w-1 h-full bg-emerald-500"></div>
        <div class="bg-emerald-50 text-emerald-800 px-6 py-4 flex justify-between items-center border-b border-emerald-100">
          <div>
            <h2 class="font-bold text-lg">Cash Sales</h2>
            <p class="text-emerald-600/80 text-xs">Excess amount & ₱1,000s</p>
          </div>
          <span id="excess-total" class="bg-white px-3 py-1 rounded-full text-sm font-mono font-bold text-emerald-600 shadow-sm">₱0</span>
        </div>
        <div class="p-6">
            <ul id="excess-list" class="space-y-3"></ul>
        </div>
      </section>

    </div>
  </div>

  <script>
    const TARGET = 5000;
    const DENOMS = [
      { value: 1000, id: 'amt-1000' },
      { value: 500, id: 'amt-500' },
      { value: 200, id: 'amt-200' },
      { value: 100, id: 'amt-100' },
      { value: 50, id: 'amt-50' },
      { value: 20, id: 'amt-20' },
      { value: 10, id: 'amt-10' },
      { value: 5, id: 'amt-5' },
      { value: 1, id: 'amt-1' }
    ];

    function getStock() {
      return DENOMS.map(d => {
        const el = document.getElementById(d.id);
        const qty = Math.max(0, parseInt(el.value, 10) || 0);
        const amount = qty * d.value;
        return { value: d.value, qty, amount };
      });
    }

    function updateTotalDisplay() {
        const stock = getStock();
        const total = stock.reduce((sum, s) => sum + s.amount, 0);
        document.getElementById('current-total').textContent = '₱' + total.toLocaleString();
    }

    DENOMS.forEach(d => {
        document.getElementById(d.id).addEventListener('input', updateTotalDisplay);
    });
    
    document.getElementById('clear-btn').addEventListener('click', () => {
        DENOMS.forEach(d => document.getElementById(d.id).value = '');
        updateTotalDisplay();
        document.getElementById('result-container').classList.add('hidden');
        document.getElementById('error-box').classList.add('hidden');
    });

    function getPlanTotal(plan) {
        return Object.values(plan).reduce((acc, item) => acc + (item.qty * item.value), 0);
    }

    function computeCashFund() {
      const stock = getStock();
      
      const byValue = {}; 
      const availability = {}; 
      
      let totalAvailableForFund = 0;

      DENOMS.forEach(d => {
        const s = stock.find(x => x.value === d.value);
        availability[d.value] = s ? s.qty : 0;
        byValue[d.value] = { value: d.value, qty: 0 }; 
        
        if (d.value !== 1000) {
            totalAvailableForFund += (s ? s.qty : 0) * d.value;
        }
      });

      if (totalAvailableForFund < TARGET) {
          return { error: `You only have ₱${totalAvailableForFund.toLocaleString()} in bills smaller than ₱1,000. You need at least ₱5,000 in smaller denominations.` };
      }

      let remaining = TARGET;
      
      const usable1Pieces = Math.floor((availability[1] || 0) / 5) * 5;
      const use1 = Math.min(usable1Pieces, remaining);
      byValue[1].qty = use1;
      remaining -= use1 * 1;

      const usable5Pieces = Math.floor((availability[5] || 0) / 2) * 2;
      let use5 = Math.min(usable5Pieces, Math.floor(remaining / 5));
      byValue[5].qty = use5;
      remaining -= use5 * 5;

      let use10 = Math.min(availability[10] || 0, Math.floor(remaining / 10));
      byValue[10].qty = use10;
      remaining -= use10 * 10;

      let use20 = Math.min(availability[20] || 0, Math.floor(remaining / 20));
      byValue[20].qty = use20;
      remaining -= use20 * 20;
  
      let coinTotal = byValue[1].qty * 1 + byValue[5].qty * 5 + byValue[10].qty * 10 + byValue[20].qty * 20;
      let remainder = coinTotal % 50;

      if (remainder > 0) {
          let toRemove = remainder;
          while (toRemove >= 20 && byValue[20].qty > 0) { byValue[20].qty--; toRemove -= 20; coinTotal -= 20; }
          while (toRemove >= 10 && byValue[10].qty > 0) { byValue[10].qty--; toRemove -= 10; coinTotal -= 10; }
          while (toRemove >= 5 && byValue[5].qty > 0) { byValue[5].qty--; toRemove -= 5; coinTotal -= 5; }
          while (toRemove >= 1 && byValue[1].qty > 0) { byValue[1].qty--; toRemove -= 1; coinTotal -= 1; }
      }
      
      while (coinTotal % 50 !== 0) {
         if (byValue[1].qty > 0) { byValue[1].qty--; coinTotal -= 1; }
         else if (byValue[5].qty > 0) { byValue[5].qty--; coinTotal -= 5; }
         else if (byValue[10].qty > 0) { byValue[10].qty--; coinTotal -= 10; }
         else if (byValue[20].qty > 0) { byValue[20].qty--; coinTotal -= 20; }
         else { break; } 
      }
      
      remaining = TARGET - coinTotal;

      const avail100 = availability[100] || 0;
      const avail50 = availability[50] || 0;
      const avail200 = availability[200] || 0;
      const avail500 = availability[500] || 0;
      
      const R = remaining;
      let filled = false;
      
      for (let use100 = Math.min(avail100, Math.floor(R / 100)); use100 >= 0 && !filled; use100--) {
        const rest1 = R - use100 * 100;
        
        for (let use50 = Math.min(avail50, Math.floor(rest1 / 50)); use50 >= 0 && !filled; use50--) {
          const rest2 = rest1 - use50 * 50;
          
          for (let use200 = Math.min(avail200, Math.floor(rest2 / 200)); use200 >= 0; use200--) {
            const rest3 = rest2 - use200 * 200;
            const use500 = rest3 / 500;
            
            if (use500 === Math.floor(use500) && use500 <= avail500) {
              byValue[100].qty = use100;
              byValue[50].qty = use50;
              byValue[200].qty = use200;
              byValue[500].qty = use500;
              remaining = 0;
              filled = true;
              break;
            }
          }
        }
      }
      
      if (!filled) remaining = R; 
      if (remaining > 0 && remaining <= 4) {
        const leftover1 = (availability[1] || 0) - byValue[1].qty;
        const bridge = Math.min(leftover1, remaining);
        byValue[1].qty += bridge;
        remaining -= bridge;
      }

      if (remaining !== 0) return { error: "Could not form exactly ₱5,000 using your mix of smaller bills. Try adjusting ₱50s or ₱100s." };

      const billsToCheck = [50, 100, 200]; 
      
      billsToCheck.forEach(billVal => {
          const avail = availability[billVal] || 0;
          const used = byValue[billVal].qty;
          const inExcess = avail - used;

          if (inExcess > 0) {
              let currentCoinTotal = (byValue[1].qty * 1) + (byValue[5].qty * 5) + (byValue[10].qty * 10) + (byValue[20].qty * 20);
              
              let maxSwaps = Math.min(inExcess, Math.floor(currentCoinTotal / billVal));

              if (maxSwaps > 0) {
                  byValue[billVal].qty += maxSwaps;
                  let amountToRemove = maxSwaps * billVal;
                  
                  const coinDenoms = [20, 10, 5, 1];
                  
                  for (let c of coinDenoms) {
                      while (amountToRemove >= c && byValue[c].qty > 0) {
                          byValue[c].qty--;
                          amountToRemove -= c;
                      }
                  }
              }
          }
      });


      const cashFund = DENOMS.map(d => ({ value: d.value, qty: byValue[d.value].qty }));
      
      const excessStock = DENOMS.map(d => ({
        value: d.value,
        qty: (availability[d.value] || 0) - byValue[d.value].qty
      }));

      return { cashFund, excessStock };
    }

    function formatBreakdownRow(b) {
      if (b.qty === 0) return '';
      return `
        <li class="flex justify-between items-center py-2 border-b border-gray-100 last:border-0">
            <div class="flex items-center gap-3">
                <span class="font-bold text-gray-800 text-lg w-8 text-right">${b.qty}</span>
                <span class="text-xs text-gray-400 font-medium uppercase tracking-wider">pcs</span>
                <span class="text-gray-600 bg-gray-100 px-2 py-0.5 rounded text-sm">₱${b.value.toLocaleString()}</span>
            </div>
            <span class="font-bold font-mono text-gray-700">₱${(b.qty * b.value).toLocaleString()}</span>
        </li>`;
    }

    function showError(msg) {
      const box = document.getElementById('error-box');
      const text = document.getElementById('error-text');
      text.textContent = msg;
      box.classList.remove('hidden');
      document.getElementById('result-container').classList.add('hidden');
    }

    function showCashFundResult(result) {
      document.getElementById('error-box').classList.add('hidden');

      const cashFund = result.cashFund.filter(b => b.qty > 0).sort((a, b) => b.value - a.value);
      const list = document.getElementById('breakdown-list');
      list.innerHTML = cashFund.length 
        ? cashFund.map(formatBreakdownRow).join('') 
        : '<li class="text-center text-gray-400 py-4 italic">No bills used (Logic Error)</li>';

      const excess = result.excessStock.filter(b => b.qty > 0).sort((a, b) => b.value - a.value);
      const excessList = document.getElementById('excess-list');
      excessList.innerHTML = excess.length
        ? excess.map(formatBreakdownRow).join('')
        : '<li class="text-center text-emerald-600/50 py-4 italic text-sm">No excess cash</li>';
      
      const excessTotal = result.excessStock.reduce((sum, b) => sum + b.value * b.qty, 0);
      document.getElementById('excess-total').textContent = '₱' + excessTotal.toLocaleString();
      
      document.getElementById('result-container').classList.remove('hidden');
    }

    document.getElementById('calculate').addEventListener('click', () => {
      const result = computeCashFund();
      if (result.error) {
        showError(result.error);
        return;
      }
      showCashFundResult(result);
    });
  </script>
</body>
</html>